<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Juego de Palabras Desordenadas</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
    <style>
        #imagen-container {
            text-align: center;
            margin-top: 20px;
        }
        .palabra-buscada {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 10px;
        }
        img {
            max-width: 100%;
            height: auto;
            border-radius: 8px;
        }
        .letras-container {
            margin: 20px;
            display: flex;
            gap: 10px;
            justify-content: center;
        }
        .letra {
            padding: 10px;
            font-size: 20px;
            font-weight: bold;
            background-color: #e0e0e0;
            border-radius: 5px;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <h1>Juego de Palabras Desordenadas</h1>
    <div id="imagen-container"></div>
    <div class="letras-container" id="letras-container"></div>
    <button onclick="validarRespuesta()">Validar</button>
    <button onclick="cargarNuevaPalabra()" style="display: none;" id="continuar-btn">Continuar</button>
    <button onclick="terminarJuego()">Terminar</button>

    <script>
        let palabras = [];
        let palabraActual = "";
        let palabraDesordenada = "";
        let respuestaUsuario = [];

        // Cargar el archivo .csv
        Papa.parse("./palabras/palabras.csv", {
            download: true,
            header: true,
            complete: function(results) {
                palabras = results.data.map(row => row.Palabra);
                cargarNuevaPalabra();
            }
        });

        async function cargarNuevaPalabra() {
            document.getElementById("continuar-btn").style.display = "none";
            const palabraAleatoria = obtenerPalabraAleatoria();
            palabraActual = palabraAleatoria;
            palabraDesordenada = desordenarPalabra(palabraAleatoria);
            respuestaUsuario = [];

            await mostrarImagen(palabraAleatoria);
            mostrarLetrasDesordenadas(palabraDesordenada);
        }

        function obtenerPalabraAleatoria() {
            const indiceAleatorio = Math.floor(Math.random() * palabras.length);
            return palabras[indiceAleatorio];
        }

        function desordenarPalabra(palabra) {
            const letras = palabra.split("");
            for (let i = letras.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [letras[i], letras[j]] = [letras[j], letras[i]];
            }
            return letras.join("");
        }

        async function mostrarImagen(palabra) {
            const apiKey = "47025182-8154449cd611439901ec5a891"; // Agrega tu clave de Pixabay aquí
            const response = await fetch(`https://pixabay.com/api/?key=${apiKey}&q=${encodeURIComponent(palabra)}&image_type=photo&per_page=3`);
            const data = await response.json();

            if (data.hits.length > 0) {
                const imagenAleatoria = data.hits[Math.floor(Math.random() * data.hits.length)];
                const imagenContainer = document.getElementById("imagen-container");
                imagenContainer.innerHTML = `
                    <div class="palabra-buscada">¿Qué palabra es?</div>
                    <img src="${imagenAleatoria.webformatURL}" alt="${palabra}" />
                `;
            } else {
                console.log("No se encontraron imágenes para la palabra:", palabra);
            }
        }

        function mostrarLetrasDesordenadas(palabra) {
            const letrasContainer = document.getElementById("letras-container");
            letrasContainer.innerHTML = "";
            palabra.split("").forEach((letra, index) => {
                const span = document.createElement("span");
                span.classList.add("letra");
                span.textContent = letra;
                span.onclick = () => seleccionarLetra(index);
                letrasContainer.appendChild(span);
            });
        }

        function seleccionarLetra(index) {
            const letrasContainer = document.getElementById("letras-container");
            const letra = letrasContainer.children[index].textContent;
            respuestaUsuario.push(letra);
            letrasContainer.children[index].style.visibility = "hidden";
        }

        function validarRespuesta() {
            const palabraUsuario = respuestaUsuario.join("");
            if (palabraUsuario === palabraActual) {
                alert("¡Correcto! Has acomodado la palabra correctamente.");
                document.getElementById("continuar-btn").style.display = "inline";
            } else {
                alert("Incorrecto, intenta de nuevo.");
                resetearLetras();
            }
        }

        function resetearLetras() {
            respuestaUsuario = [];
            const letrasContainer = document.getElementById("letras-container");
            Array.from(letrasContainer.children).forEach(letra => letra.style.visibility = "visible");
        }

        function terminarJuego() {
            window.location.href = "interfaz_menu.html";
        }
    </script>
</body>
</html>
